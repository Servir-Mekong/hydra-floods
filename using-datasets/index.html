
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.8">
    
    
      
        <title>Using the Dataset class - HYDRAFloods Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.644de097.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dataset-structure" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="HYDRAFloods Documentation" class="md-header__button md-logo" aria-label="HYDRAFloods Documentation" data-md-component="logo">
      
  <img src="../img/hydrafloods_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            HYDRAFloods Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Using the Dataset class
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="HYDRAFloods Documentation" class="md-nav__button md-logo" aria-label="HYDRAFloods Documentation" data-md-component="logo">
      
  <img src="../img/hydrafloods_logo.png" alt="logo">

    </a>
    HYDRAFloods Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Using the Dataset class
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Using the Dataset class
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dataset-structure" class="md-nav__link">
    Dataset structure
  </a>
  
    <nav class="md-nav" aria-label="Dataset structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#specialized-datasets" class="md-nav__link">
    Specialized Datasets
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-dataset-from-a-computed-eeimagecollection" class="md-nav__link">
    Creating a Dataset from a computed ee.ImageCollection
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#applying-a-function" class="md-nav__link">
    Applying a function
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#merging-datasets" class="md-nav__link">
    Merging Datasets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#joining-datasets" class="md-nav__link">
    Joining Datasets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#temporal-aggregation" class="md-nav__link">
    Temporal aggregation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#piping-multiple-functions" class="md-nav__link">
    Piping multiple functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-your-own-dataset-class" class="md-nav__link">
    Writing your own dataset class
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../algorithms/" class="md-nav__link">
        Algorithms
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../workflow-example/" class="md-nav__link">
        Workflow Example
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        Command Line Interface
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../corrections/" class="md-nav__link">
        corrections module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../datasets/" class="md-nav__link">
        datasets module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../depths/" class="md-nav__link">
        depths module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../decorators/" class="md-nav__link">
        decorators module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fetch/" class="md-nav__link">
        fetch module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../floods/" class="md-nav__link">
        floods module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../filtering/" class="md-nav__link">
        filtering module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fuzzy/" class="md-nav__link">
        fuzzy module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../geeutils/" class="md-nav__link">
        geeutils module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../indices/" class="md-nav__link">
        indices module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ml/" class="md-nav__link">
        ml module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../thresholding/" class="md-nav__link">
        thresholding module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../timeseries/" class="md-nav__link">
        timeseries module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        utils module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dswfp/" class="md-nav__link">
        workflows.dswfp module
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dataset-structure" class="md-nav__link">
    Dataset structure
  </a>
  
    <nav class="md-nav" aria-label="Dataset structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#specialized-datasets" class="md-nav__link">
    Specialized Datasets
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-dataset-from-a-computed-eeimagecollection" class="md-nav__link">
    Creating a Dataset from a computed ee.ImageCollection
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#applying-a-function" class="md-nav__link">
    Applying a function
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#merging-datasets" class="md-nav__link">
    Merging Datasets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#joining-datasets" class="md-nav__link">
    Joining Datasets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#temporal-aggregation" class="md-nav__link">
    Temporal aggregation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#piping-multiple-functions" class="md-nav__link">
    Piping multiple functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-your-own-dataset-class" class="md-nav__link">
    Writing your own dataset class
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


  <h1>Using the Dataset class</h1>

<p>Here are a more in depth examples of using <code>hydrafloods.Dataset</code> classes for working with imagery. It is expected that the code is run in an interactive python session such as IPython or in a Jupyter Notebook as later code blocks will use variables from previous ones.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">ee</span>
<span class="n">ee</span><span class="o">.</span><span class="n">Initialze</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">hydrafloods</span> <span class="k">as</span> <span class="nn">hf</span>
</code></pre></div>

<h2 id="dataset-structure">Dataset structure</h2>
<div class="codehilite"><pre><span></span><code><span class="n">region</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">country_bbox</span><span class="p">(</span><span class="s2">&quot;Cambodia&quot;</span><span class="p">)</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="s2">&quot;2019-01-01&quot;</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="s2">&quot;2019-07-01&quot;</span>

<span class="c1"># get a Landsat 8 collection</span>
<span class="n">lc8</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">Landsat8</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lc8</span><span class="p">)</span>
<span class="c1"># should look like</span>
<span class="c1"># HYDRAFloods Dataset:</span>
<span class="c1"># {&#39;asset_id&#39;: &#39;LANDSAT/LC08/C01/T1_SR&#39;,</span>
<span class="c1">#  &#39;end_time&#39;: &#39;2019-07-01&#39;,</span>
<span class="c1">#  &#39;name&#39;: &#39;Landsat8&#39;,</span>
<span class="c1">#  &#39;region&#39;: [[[...], [...], [...], [...], [...]]],</span>
<span class="c1">#  &#39;start_time&#39;: &#39;2019-01-01&#39;}</span>
</code></pre></div>

<p>A dataset object has a few properties that we can access to assist in processing or understanding the data contained in the dataset. Here is a list of properties and a description:</p>
<ul>
<li><code>Dataset.collection</code>: Earth Engine image collection object that the dataset class wraps</li>
<li><code>Dataset.n_images</code>: client side number of images in collection</li>
<li><code>Dataset.dates</code>: client side list of datetime information of all images acquisition times</li>
</ul>
<p>Let's inspect some of these properties</p>
<div class="codehilite"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="n">lc8</span><span class="o">.</span><span class="n">n_images</span><span class="p">)</span>
<span class="c1"># should equal 197</span>

<span class="nb">print</span><span class="p">(</span><span class="n">lc8</span><span class="o">.</span><span class="n">dates</span><span class="p">)</span>
<span class="c1"># should look something like</span>
<span class="c1"># [&#39;2019-01-12 03:06:42.950&#39;,</span>
<span class="c1">#  &#39;2019-01-28 03:06:38.990&#39;,</span>
<span class="c1">#  ... ,</span>
<span class="c1"># &#39;2019-06-01 03:32:06.850&#39;]</span>

<span class="c1"># since `Dataset.collection` is a server side object we will just</span>
<span class="c1"># check that it is in fact a ee.ImageCollection object</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">lc8</span><span class="o">.</span><span class="n">collection</span><span class="p">,</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">))</span>
<span class="c1"># should == True</span>
</code></pre></div>

<h3 id="specialized-datasets">Specialized Datasets</h3>
<p><code>hydrafloods</code> has specialized datasets classes that extend a <code>hydrafloods.Dataset</code> class and are common image collections used in surface water mapping. These specialized datasets include a custom <code>qa()</code> method based on quality assessment bands that gets called on initialization to mask poor quality pixels and custom methods that make harmonization easy. Furthermore, the optical sensor bands are automatically renamed to a common scheme so that they can be used together easily. Here is a list of the specialized datasets with links to information on methods:</p>
<p>Really, one can think of the custom <code>qa()</code> method as a preprocessing step that you would like to happen on <em>all</em> images in the dataset so it is not just restricted to specific sensors as seen in a later section.</p>
<ul>
<li>Sentinel 1: <a href="/hydra-floods/datasets/#hydrafloods.datasets.Sentinel1"><code>hydrafloods.Sentinel1</code></a></li>
<li>Sentinel 2: <a href="/hydra-floods/datasets/#hydrafloods.datasets.Sentinel2"><code>hydrafloods.Sentinel2</code></a></li>
<li>Landsat 8: <a href="/hydra-floods/datasets/#hydrafloods.datasets.Landsat8"><code>hydrafloods.Landsat8</code></a></li>
<li>Landsat 7: <a href="/hydra-floods/datasets/#hydrafloods.datasets.Landsat7"><code>hydrafloods.Landsat7</code></a></li>
<li>VIIRS: <a href="/hydra-floods/datasets/#hydrafloods.datasets.Viirs"><code>hydrafloods.Viirs</code></a></li>
<li>MODIS: <a href="/hydra-floods/datasets/#hydrafloods.datasets.Modis"><code>hydrafloods.Modis</code></a></li>
</ul>
<p>To provide an example of using the internal <code>qa()</code> method and not we can redefine the Landsat 8 collection from before but with setting <code>use_qa</code> to <code>False</code></p>
<div class="codehilite"><pre><span></span><code><span class="n">lc8</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">Landsat8</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span><span class="p">)</span>
<span class="n">lc8_noqa</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">Landsat8</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span><span class="p">,</span><span class="n">use_qa</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">thumb_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;min&quot;</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span>
    <span class="s2">&quot;max&quot;</span><span class="p">:</span><span class="mi">5500</span><span class="p">,</span>
    <span class="s2">&quot;bands&quot;</span><span class="p">:</span><span class="s2">&quot;swir2,nir,green&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gamma&quot;</span><span class="p">:</span><span class="mf">1.5</span><span class="p">,</span>
    <span class="s2">&quot;dimensions&quot;</span><span class="p">:</span><span class="mi">1024</span>
<span class="p">}</span>

<span class="c1"># get thumbnail images</span>
<span class="n">qa_thumb</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">lc8</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="o">.</span><span class="n">getThumbURL</span><span class="p">(</span><span class="n">thumb_params</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">noqa_thumb</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">lc8_noqa</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="o">.</span><span class="n">getThumbURL</span><span class="p">(</span><span class="n">thumb_params</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># print urls to view thumbnails</span>
<span class="nb">print</span><span class="p">(</span><span class="n">qa_thumb</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">noqa_thumb</span><span class="p">)</span>
</code></pre></div>

<table>
<thead>
<tr>
<th align="center"><code>use_qa = True</code></th>
<th align="center"><code>use_qa = False</code></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="" src="../img/datasets_lc8_qa.png" /></td>
<td align="center"><img alt="" src="../img/datasets_lc8_noqa.png" /></td>
</tr>
</tbody>
</table>
<p>We can clearly see the image on the left has clouds and cloud shadows masked and can therefore be used directly in analysis with minimal effort. More information on the internals of these specialized datasets and how you can write your own can be found at the <a href="#writing-your-own-dataset-class">Writing your own dataset class</a> section.</p>
<h2 id="creating-a-dataset-from-a-computed-eeimagecollection">Creating a Dataset from a computed <code>ee.ImageCollection</code></h2>
<p>While HYDRAFloods provides some specialized Dataset classes for users to immediately access, there are often times when a user would like to use their own Image Collection. To this end, a method is available for users to create a dataset directly from an ee.ImageCollection object, <a href="/hydra-floods/datasets/#hydrafloods.datasets.Dataset.from_imgcollection"><code>hf.Dataset.from_imgcollection</code></a>. This allows Dataset objects to be created from image collections that have been filtered or with additional computation applied. Here is a quick example grabbing the public Planet SkySat data, filtering to the United States, and calculating NDVI:</p>
<div class="codehilite"><pre><span></span><code><span class="n">us</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">country_bbox</span><span class="p">(</span><span class="s2">&quot;United States&quot;</span><span class="p">)</span>

<span class="c1"># get the public SkySat ImageCollection for the USA</span>
<span class="c1"># and compute a NDVI band</span>
<span class="n">ic</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">(</span><span class="s2">&quot;SKYSAT/GEN-A/PUBLIC/ORTHO/MULTISPECTRAL&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">filterBounds</span><span class="p">(</span><span class="n">us</span><span class="p">)</span>
    <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">addBands</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">normalizedDifference</span><span class="p">([</span><span class="s2">&quot;N&quot;</span><span class="p">,</span><span class="s2">&quot;R&quot;</span><span class="p">])))</span>
<span class="p">)</span>

<span class="n">planet</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_imgcollection</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">planet</span><span class="o">.</span><span class="n">n_images</span><span class="p">)</span>
<span class="c1"># should equal 33</span>
</code></pre></div>

<p>It should be noted that hydrafloods will attempt to call <code>.getInfo()</code> from the <code>ee.ImageCollection</code> to get property information such as image geometries and acquisition dates. Image collections used to create a <code>hf.Dataset</code> via this method needed to be bounded (i.e. have <code>img.geometry()</code>) and have the <code>system:time_start</code> property defined. Additionally, since this passes data from the EE servers to the client, it may take some time to get the information required for the Dataset object. Therefore, <a href="#writing-your-own-dataset-class">writing your own dataset class</a> is advised if a lot or advanced computations are needed to pre-process any ImageCollection into a <code>hf.Dataset</code>.</p>
<h2 id="applying-a-function">Applying a function</h2>
<p>As we saw in the <a href="/hydra-floods/getting-started/#image-processing">Getting Stated</a> page, we can apply image processing functions using <a href="/hydra-floods/datasets/#hydrafloods.datasets.Dataset.apply_func"><code>apply_func()</code></a> by passing a function object or any keyword parameters. This method wraps a function that accepts an image as the first argument (which most <code>hydrafloods</code> image processing algorithms do) and maps it over the collection. For example, if want to create a water map using Landsat 8, we will calculate a water index and then apply a thresholding algorithm:</p>
<div class="codehilite"><pre><span></span><code><span class="n">region</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">country_bbox</span><span class="p">(</span><span class="s2">&quot;Cambodia&quot;</span><span class="p">)</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="s2">&quot;2019-01-01&quot;</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="s2">&quot;2019-03-01&quot;</span>

<span class="c1"># get a Landsat 8 collection</span>
<span class="n">lc8</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">Landsat8</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span><span class="p">)</span>

<span class="n">water_index</span> <span class="o">=</span> <span class="n">lc8</span><span class="o">.</span><span class="n">apply_func</span><span class="p">(</span><span class="n">hf</span><span class="o">.</span><span class="n">mndwi</span><span class="p">)</span>

<span class="n">water_ds</span> <span class="o">=</span> <span class="n">water_index</span><span class="o">.</span><span class="n">apply_func</span><span class="p">(</span><span class="n">hf</span><span class="o">.</span><span class="n">edge_otsu</span><span class="p">,</span>
        <span class="n">initial_threshold</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">edge_buffer</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
        <span class="n">invert</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="n">index_img</span> <span class="o">=</span> <span class="n">water_index</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
<span class="n">water_img</span> <span class="o">=</span> <span class="n">water_ds</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">mode</span><span class="p">()</span>

<span class="n">water_img</span><span class="o">.</span><span class="n">getThumbURL</span><span class="p">({</span>
    <span class="s2">&quot;min&quot;</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;max&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;palette&quot;</span><span class="p">:</span><span class="s2">&quot;beige,white,lightblue,blue,darkblue&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dimensions&quot;</span><span class="p">:</span><span class="mi">1500</span><span class="p">,</span>
    <span class="s2">&quot;region&quot;</span><span class="p">:</span><span class="n">region</span>
<span class="p">})</span>

<span class="n">water_img</span><span class="o">.</span><span class="n">getThumbURL</span><span class="p">({</span>
    <span class="s2">&quot;min&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;max&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;palette&quot;</span><span class="p">:</span><span class="s2">&quot;silver,navy&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dimensions&quot;</span><span class="p">:</span><span class="mi">1500</span><span class="p">,</span>
    <span class="s2">&quot;region&quot;</span><span class="p">:</span><span class="n">region</span>
<span class="p">})</span>
</code></pre></div>

<table>
<thead>
<tr>
<th align="center">Landsat 8 Water Index</th>
<th align="center">Landsat 8 Water Map</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="" src="../img/datasets_lc8_func_index.png" /></td>
<td align="center"><img alt="" src="../img/datasets_lc8_pipe.png" /></td>
</tr>
</tbody>
</table>
<h2 id="merging-datasets">Merging Datasets</h2>
<p>One of the simpilest ways to combine datasets is to merge. This takes the imagery in one collection and concatenates it with the original collection. We can use the <a href="/hydra-floods/datasets/#hydrafloods.datasets.Dataset.merge"><code>merge()</code></a> method to accomplish this. Additionally, the <code>merge()</code> method automatically sorts the image collections by date so we can start using dense time series right away. Here is an example of merging Landat8 and Sentinel2 datasets together:</p>
<div class="codehilite"><pre><span></span><code><span class="n">lc8</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">Landsat8</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span><span class="p">)</span>
<span class="c1"># has 71 images</span>

<span class="n">s2</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">Sentinel2</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span><span class="p">)</span>
<span class="c1"># has 798 images</span>

<span class="n">merged</span> <span class="o">=</span> <span class="n">lc8</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">merged</span><span class="o">.</span><span class="n">n_images</span><span class="p">)</span>
<span class="c1"># now has 869 images!</span>
</code></pre></div>

<h2 id="joining-datasets">Joining Datasets</h2>
<p>Joining datasets is another way to bring together two datasets but by looking at coincident imagery and combines the bands into one image. Whereas merge combined the two collections irrespective of space time overlap, <a href="/hydra-floods/datasets/#hydrafloods.datasets.Dataset.join"><code>join()</code></a> looks for overlapping data in space and time and will return only data that overlaps with the bands combined. Furthermore, the resulting images will be clipped to the overlapping region. This functionality is really helpful when looking for coincident data from multiple sensors.</p>
<div class="codehilite"><pre><span></span><code><span class="n">lc8</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">Landsat8</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span><span class="p">)</span>
<span class="c1"># has 197 images</span>

<span class="n">s1</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">Sentinel1</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span><span class="p">)</span>
<span class="c1"># has 628 images</span>

<span class="n">joined</span> <span class="o">=</span> <span class="n">lc8</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
<span class="c1"># has 131 coincident images</span>

<span class="c1"># grab the first image in the collection</span>
<span class="c1"># will have optical and sar bands</span>
<span class="n">first</span> <span class="o">=</span> <span class="n">joined</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">first</span><span class="o">.</span><span class="n">bandNames</span><span class="p">()</span><span class="o">.</span><span class="n">getInfo</span><span class="p">())</span>
<span class="c1"># should equal the following:</span>
<span class="c1"># [&#39;blue&#39;, &#39;green&#39;, &#39;red&#39;, &#39;nir&#39;, &#39;swir1&#39;, &#39;swir2&#39;, &#39;VV&#39;, &#39;VH&#39;, &#39;angle&#39;]</span>
<span class="c1"># both optical and SAR bands are included in the image</span>

<span class="c1"># visualize the different bands</span>
<span class="n">optical_thumb</span> <span class="o">=</span> <span class="n">first</span><span class="o">.</span><span class="n">getThumbURL</span><span class="p">({</span>
    <span class="s2">&quot;min&quot;</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span>
    <span class="s2">&quot;max&quot;</span><span class="p">:</span><span class="mi">5500</span><span class="p">,</span>
    <span class="s2">&quot;bands&quot;</span><span class="p">:</span><span class="s2">&quot;swir2,nir,green&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gamma&quot;</span><span class="p">:</span><span class="mf">1.5</span><span class="p">,</span>
    <span class="s2">&quot;dimensions&quot;</span><span class="p">:</span><span class="mi">1024</span>
<span class="p">})</span>
<span class="n">sar_thumb</span> <span class="o">=</span> <span class="n">first</span><span class="o">.</span><span class="n">getThumbURL</span><span class="p">({</span>
    <span class="s2">&quot;min&quot;</span><span class="p">:[</span><span class="o">-</span><span class="mi">25</span><span class="p">,</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span><span class="o">-</span><span class="mi">25</span><span class="p">],</span>
    <span class="s2">&quot;max&quot;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
    <span class="s2">&quot;bands&quot;</span><span class="p">:</span><span class="s2">&quot;VV,VH,VV&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dimensions&quot;</span><span class="p">:</span><span class="mi">1024</span>
<span class="p">})</span>

<span class="c1"># print urls to view thumbnails</span>
<span class="nb">print</span><span class="p">(</span><span class="n">optical_thumb</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sar_thumb</span><span class="p">)</span>
</code></pre></div>

<table>
<thead>
<tr>
<th align="center">Landsat 8 2019-01-28</th>
<th align="center">Sentinel 1 2019-01-28</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="" src="../img/datasets_lc8_joined.png" /></td>
<td align="center"><img alt="" src="../img/datasets_s1_joined.png" /></td>
</tr>
</tbody>
</table>
<h2 id="temporal-aggregation">Temporal aggregation</h2>
<p>A common workflow is merging data and make composites for individual dates that data is available. A good example of this is the MODIS sensor that is onboard the Terra and Aqua satellite. We can create daily composites of the imagery by merging the datasets then looping over each day to mosaic the data. <code>hydrafloods</code> has a method <a href="/hydra-floods/datasets/#hydrafloods.datasets.Dataset.aggregate_time"><code>aggregate_time()</code></a> to do the mosaicing sequentially in time. Here we create a combined MODIS Terra and Aqua dataset.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># define new time range</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="s2">&quot;2018-11-03&quot;</span>  
<span class="n">end_time</span> <span class="o">=</span> <span class="s2">&quot;2018-11-15&quot;</span>

<span class="c1"># get the terra MODIS dataset</span>
<span class="n">terra</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">Modis</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span><span class="p">)</span>
<span class="c1"># get the aqua MODIS dataset</span>
<span class="c1"># note calling the asset_id explicitly</span>
<span class="n">aqua</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">Modis</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span><span class="p">,</span><span class="n">asset_id</span><span class="o">=</span><span class="s2">&quot;MODIS/006/MYD09GA&quot;</span><span class="p">)</span>

<span class="c1"># merge the collections into one</span>
<span class="n">merged</span> <span class="o">=</span> <span class="n">terra</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">aqua</span><span class="p">)</span>
<span class="c1"># aggregate in time</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">aggregate_time</span><span class="p">(</span><span class="n">reducer</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">)</span>

<span class="c1"># get thumb for first image in terra dataset</span>
<span class="n">terra</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">getThumbURL</span><span class="p">({</span>
    <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
    <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">5500</span><span class="p">,</span>
    <span class="s2">&quot;bands&quot;</span><span class="p">:</span> <span class="s2">&quot;swir2,nir,green&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span>
    <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
    <span class="s2">&quot;dimensions&quot;</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span>
    <span class="s2">&quot;crs&quot;</span><span class="p">:</span> <span class="s2">&quot;EPSG:4326&quot;</span>
<span class="p">})</span>

<span class="c1"># get thumb for first image in aqua dataset</span>
<span class="n">aqua</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">getThumbURL</span><span class="p">({</span>
    <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
    <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">5500</span><span class="p">,</span>
    <span class="s2">&quot;bands&quot;</span><span class="p">:</span> <span class="s2">&quot;swir2,nir,green&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span>
    <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
    <span class="s2">&quot;dimensions&quot;</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span>
    <span class="s2">&quot;crs&quot;</span><span class="p">:</span> <span class="s2">&quot;EPSG:4326&quot;</span>
<span class="p">})</span>

<span class="c1"># get thumb for first image in merged dataset</span>
<span class="n">agg</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">getThumbURL</span><span class="p">({</span>
    <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
    <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">5500</span><span class="p">,</span>
    <span class="s2">&quot;bands&quot;</span><span class="p">:</span> <span class="s2">&quot;swir2,nir,green&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span>
    <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
    <span class="s2">&quot;dimensions&quot;</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span>
    <span class="s2">&quot;crs&quot;</span><span class="p">:</span> <span class="s2">&quot;EPSG:4326&quot;</span>
<span class="p">})</span>
</code></pre></div>

<table>
<thead>
<tr>
<th align="center">MODIS Terra 2018-11-03</th>
<th align="center">MODIS Aqua 2018-11-03</th>
<th align="center">Aggregated</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="" src="../img/datasets_terra_noagg.png" /></td>
<td align="center"><img alt="" src="../img/datasets_aqua_noagg.png" /></td>
<td align="center"><img alt="" src="../img/datasets_terra_aqua_agg.png" /></td>
</tr>
</tbody>
</table>
<p>By doing this we can fill in gaps where some data is missing with other sensors. We see in the above example that combining the MODIS data from Terra and Aqua we can get more coverage in the event of flooding. By default the method will take unique dates within the dataset and aggregate by one day as seen in the above example.</p>
<p>We can also use this functionality to make monthly or yearly composites of data by specifying the dates that we want to start the aggregation with and a period after the start dates to do the aggregation. Here is an example creating yearly composites from 2015 through 2019:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># define new time range</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="s2">&quot;2015-01-01&quot;</span>  
<span class="n">end_time</span> <span class="o">=</span> <span class="s2">&quot;2020-01-01&quot;</span>

<span class="c1"># define the dates in which to start aggregation</span>
<span class="n">year_starts</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;2015-01-01&quot;</span><span class="p">,</span><span class="s2">&quot;2016-01-01&quot;</span><span class="p">,</span><span class="s2">&quot;2017-01-01&quot;</span><span class="p">,</span><span class="s2">&quot;2018-01-01&quot;</span><span class="p">,</span><span class="s2">&quot;2019-01-01&quot;</span><span class="p">]</span>

<span class="c1"># get the terra MODIS dataset</span>
<span class="n">terra</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">Modis</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span><span class="p">)</span>
<span class="c1"># apply the aggregation</span>
<span class="n">yearly</span> <span class="o">=</span> <span class="n">terra</span><span class="o">.</span><span class="n">aggregate_time</span><span class="p">(</span><span class="n">dates</span><span class="o">=</span><span class="n">year_starts</span><span class="p">,</span><span class="n">period</span><span class="o">=</span><span class="mi">365</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">yearly</span><span class="o">.</span><span class="n">dates</span><span class="p">)</span>
<span class="c1"># should equal to:</span>
<span class="c1"># [&#39;2015-01-01 00:00:00.000&#39;,</span>
<span class="c1">#  &#39;2016-01-01 00:00:00.000&#39;,</span>
<span class="c1">#  &#39;2017-01-01 00:00:00.000&#39;,</span>
<span class="c1">#  &#39;2018-01-01 00:00:00.000&#39;,</span>
<span class="c1">#  &#39;2019-01-01 00:00:00.000&#39;]</span>
</code></pre></div>

<p>As seen, this method allows for customization of when to start aggregations and how long/which dates to include in aggregation which can be helpful for unique timings like dekads.</p>
<h2 id="piping-multiple-functions">Piping multiple functions</h2>
<p>As seen in the <a href="#applying-a-function">"Applying a function"</a> section, we can easily process imagery by passing individual functions into  <code>.apply_func()</code>. While this method of writing the computation is easy to read syntaxually, it is however inefficient for for Earth Engien to apply the computations. This is because each function passed through <code>.apply_func()</code> applies the function to all imagery in the Dataset. For example, if there are three functions you want to apply, then it will loop through all of the imagery three times. This can cause computation timeout or memory errors on Earth Engine's side if there is a lot to compute using multiple mapped functions.</p>
<p>The <a href="/hydra-floods/datasets/#hydrafloods.datasets.Dataset.pipe"><code>.pipe()</code></a> method allows for users to apply multiple functions to a Dataset with only one pass through the imagery. This is the preferred method to chain together multiple functions. For example, if we want to create water maps from Landsat 8 we would calculate a water index (e.g. MNDWI) then apply the water mapping algorithm. Here we can tell <code>.pipe()</code> the order of functions to apply and the arguments (if any) and it will nest the functions into one to map over.</p>
<div class="codehilite"><pre><span></span><code><span class="n">region</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">country_bbox</span><span class="p">(</span><span class="s2">&quot;Cambodia&quot;</span><span class="p">)</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="s2">&quot;2019-01-01&quot;</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="s2">&quot;2019-03-01&quot;</span>

<span class="c1"># get a Landsat 8 collection</span>
<span class="n">lc8</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">Landsat8</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span><span class="p">)</span>

<span class="n">process_steps</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">hf</span><span class="o">.</span><span class="n">mndwi</span><span class="p">,</span>
    <span class="p">(</span><span class="n">hf</span><span class="o">.</span><span class="n">edge_otsu</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">initial_threshold</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">edge_buffer</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
        <span class="n">invert</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">))</span>
<span class="p">)</span>

<span class="n">water</span> <span class="o">=</span> <span class="n">lc8</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">process_steps</span><span class="p">)</span>

<span class="n">water_img</span> <span class="o">=</span> <span class="n">water</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">mode</span><span class="p">()</span>

<span class="n">water_img</span><span class="o">.</span><span class="n">getThumbURL</span><span class="p">({</span>
    <span class="s2">&quot;min&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;max&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;palette&quot;</span><span class="p">:</span><span class="s2">&quot;silver,navy&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dimensions&quot;</span><span class="p">:</span><span class="mi">1500</span><span class="p">,</span>
    <span class="s2">&quot;region&quot;</span><span class="p">:</span><span class="n">region</span>
<span class="p">})</span>
</code></pre></div>

<p><img alt="" src="../img/datasets_lc8_pipe.png" /></p>
<p>The <code>.pipe()</code> methods allows for <em>any</em> function object to be passed as long as the first argument to the function is an ee.Image object. So, users can write their own custom functions or supply anonymous functions (i.e. <code>lambda</code> functions) and it will work. Again, this is the preferred method when doing a lot of preprocessing to prevent unnecessarily looping through the dataset multiple times.</p>
<h2 id="writing-your-own-dataset-class">Writing your own dataset class</h2>
<p>The <code>hydrafloods.Dataset</code> class can be used to create custom dataset classes for sensors. This is helpful when there is a sensor that will be used often with other datasets using <code>hydrafloods</code>. Here is an example of writing a custom <code>hydrafloods.Dataset</code> class for the GOES16 collection. We will predefine the <code>asset_id</code> argument and define a <code>qa()</code> method to scale data to reflectance and mask poor quality pixels.</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Goes16</span><span class="p">(</span><span class="n">hf</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">asset_id</span><span class="o">=</span><span class="s2">&quot;NOAA/GOES/16/MCMIPF&quot;</span><span class="p">,</span> <span class="n">use_qa</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># initialize the parent class</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Goes16</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">asset_id</span><span class="o">=</span><span class="n">asset_id</span><span class="p">,</span> <span class="n">use_qa</span><span class="o">=</span><span class="n">use_qa</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># list of band names to return with new names</span>
        <span class="n">old_band_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CMI_C01&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;CMI_C02&quot;</span><span class="p">,</span><span class="s2">&quot;CMI_C03&quot;</span><span class="p">,</span><span class="s2">&quot;CMI_C05&quot;</span><span class="p">,</span><span class="s2">&quot;CMI_C06&quot;</span><span class="p">]</span>
        <span class="n">new_band_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span><span class="s2">&quot;green&quot;</span><span class="p">,</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="s2">&quot;nir&quot;</span><span class="p">,</span><span class="s2">&quot;swir1&quot;</span><span class="p">,</span><span class="s2">&quot;swir2&quot;</span><span class="p">]</span>

        <span class="c1"># change the band names to something</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="n">old_band_names</span><span class="p">,</span> <span class="n">new_band_names</span>
        <span class="p">)</span>

        <span class="k">return</span>

    <span class="c1"># define a qa method and wrap in the carry_metadata decorator</span>
    <span class="c1"># retains metadata for each image</span>
    <span class="c1"># qa() will get called on super() if use_qa==True</span>
    <span class="nd">@hf</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">keep_attrs</span>
    <span class="k">def</span> <span class="nf">qa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Custom QA masking method for Goes17 data</span>
<span class="sd">        Scales data to reflectance and finds poor quality images</span>
<span class="sd">        add a psuedo-green band using methods from https://doi.org/10.1029/2018EA000379</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">band_names</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">bandNames</span><span class="p">()</span>

        <span class="c1"># get scale and offset values</span>
        <span class="n">scale_properties</span> <span class="o">=</span> <span class="n">band_names</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="s2">&quot;_scale&quot;</span><span class="p">))</span>
        <span class="n">offset_properties</span> <span class="o">=</span> <span class="n">band_names</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="s2">&quot;_offset&quot;</span><span class="p">))</span>

        <span class="c1"># convert scale/offset values to image</span>
        <span class="n">scale_img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">toDictionary</span><span class="p">(</span><span class="n">scale_properties</span><span class="p">)</span><span class="o">.</span><span class="n">toImage</span><span class="p">()</span>
        <span class="n">offset_img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">toDictionary</span><span class="p">(</span><span class="n">offset_properties</span><span class="p">)</span><span class="o">.</span><span class="n">toImage</span><span class="p">()</span>

        <span class="c1"># get qa bands and set 0 to 1 and everything else to 0</span>
        <span class="n">qa_img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;^(DQF).*&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">Not</span><span class="p">()</span>

        <span class="c1"># get the actual image data and apply qa mask</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;^(CMI).*&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">updateMask</span><span class="p">(</span><span class="n">qa_img</span><span class="p">)</span>

        <span class="c1"># scale imagery to reflectance</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">scale_img</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">offset_img</span><span class="p">)</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">qa_img</span><span class="p">)</span>

        <span class="c1"># compute psuedo green band</span>
        <span class="n">green_weights</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
        <span class="n">green_band</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">img</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s2">&quot;CMI_C01&quot;</span><span class="p">,</span> <span class="s2">&quot;CMI_C02&quot;</span><span class="p">,</span> <span class="s2">&quot;CMI_C03&quot;</span><span class="p">])</span>
            <span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">green_weights</span><span class="p">)</span>
            <span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="s2">&quot;sum&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">addBands</span><span class="p">(</span><span class="n">green_band</span><span class="p">)</span>


<span class="c1"># get a GOES collection over the United States</span>
<span class="n">us</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">country_bbox</span><span class="p">(</span><span class="s2">&quot;United States&quot;</span><span class="p">)</span>
<span class="n">goes</span> <span class="o">=</span> <span class="n">Goes16</span><span class="p">(</span><span class="n">us</span><span class="p">,</span><span class="s2">&quot;2020-07-28T18:40:18&quot;</span><span class="p">,</span><span class="s2">&quot;2020-07-29T00:00:00&quot;</span><span class="p">)</span>

<span class="c1"># view the results from the GOES16 collection</span>
<span class="n">first_img</span> <span class="o">=</span> <span class="n">goes</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="n">viz_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;min&quot;</span><span class="p">:</span><span class="mf">0.05</span><span class="p">,</span>
    <span class="s2">&quot;max&quot;</span><span class="p">:</span><span class="mf">0.55</span><span class="p">,</span>
    <span class="s2">&quot;bands&quot;</span><span class="p">:</span><span class="s2">&quot;swir1,nir,green&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gamma&quot;</span><span class="p">:</span><span class="mf">1.5</span><span class="p">,</span>
    <span class="s2">&quot;region&quot;</span><span class="p">:</span><span class="n">us</span><span class="p">,</span>
    <span class="s2">&quot;dimensions&quot;</span><span class="p">:</span><span class="mi">1024</span><span class="p">,</span>
    <span class="s2">&quot;crs&quot;</span><span class="p">:</span><span class="s2">&quot;epsg:5070&quot;</span>
<span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="n">first_img</span><span class="o">.</span><span class="n">getThumbURL</span><span class="p">(</span><span class="n">viz_params</span><span class="p">))</span>
</code></pre></div>

<p><img alt="" src="../img/datasets_goes_class.png" /></p>
<p>In this example of a custom dataset class for GOES16 imagery, the <code>qa()</code> method definition is more for preprocessing to scale the imagery. A custom cloud/shadow masking workflow can easily be included and applied on the imagery. Now we are ready to use our custom GOES16 imagery with the rest of the <code>hydrafloods</code> functions!</p>
<p>More detailed information on the <code>hydrafloods.Dataset</code> class along with it's method fucntionality and arguments can be found in the <a href="/hydra-floods/datasets/">datasets module</a> API reference.</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../getting-started/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Getting Started" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Getting Started
            </div>
          </div>
        </a>
      
      
        
        <a href="../algorithms/" class="md-footer__link md-footer__link--next" aria-label="Next: Algorithms" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Algorithms
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.5e67fbfe.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c44cc438.min.js"></script>
      
    
  </body>
</html>