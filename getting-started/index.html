
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.8">
    
    
      
        <title>Getting Started - HYDRAFloods Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.644de097.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#get-a-hfdataset" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="HYDRAFloods Documentation" class="md-header__button md-logo" aria-label="HYDRAFloods Documentation" data-md-component="logo">
      
  <img src="../img/hydrafloods_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            HYDRAFloods Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Getting Started
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="HYDRAFloods Documentation" class="md-nav__button md-logo" aria-label="HYDRAFloods Documentation" data-md-component="logo">
      
  <img src="../img/hydrafloods_logo.png" alt="logo">

    </a>
    HYDRAFloods Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Getting Started
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#get-a-hfdataset" class="md-nav__link">
    Get a hf.Dataset
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#image-processing" class="md-nav__link">
    Image processing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#time-series-processing" class="md-nav__link">
    Time series processing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#machine-learning" class="md-nav__link">
    Machine Learning
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../using-datasets/" class="md-nav__link">
        Using the Dataset class
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../algorithms/" class="md-nav__link">
        Algorithms
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../workflow-example/" class="md-nav__link">
        Workflow Example
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        Command Line Interface
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../corrections/" class="md-nav__link">
        corrections module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../datasets/" class="md-nav__link">
        datasets module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../depths/" class="md-nav__link">
        depths module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../decorators/" class="md-nav__link">
        decorators module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fetch/" class="md-nav__link">
        fetch module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../floods/" class="md-nav__link">
        floods module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../filtering/" class="md-nav__link">
        filtering module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fuzzy/" class="md-nav__link">
        fuzzy module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../geeutils/" class="md-nav__link">
        geeutils module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../indices/" class="md-nav__link">
        indices module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ml/" class="md-nav__link">
        ml module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../thresholding/" class="md-nav__link">
        thresholding module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../timeseries/" class="md-nav__link">
        timeseries module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        utils module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dswfp/" class="md-nav__link">
        workflows.dswfp module
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#get-a-hfdataset" class="md-nav__link">
    Get a hf.Dataset
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#image-processing" class="md-nav__link">
    Image processing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#time-series-processing" class="md-nav__link">
    Time series processing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#machine-learning" class="md-nav__link">
    Machine Learning
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


  <h1>Getting Started</h1>

<p>Here are some quick examples of what you can do with <code>hydrafloods</code>. It is expected that the code is run in an interactive python session such as IPython or in a Jupyter Notebook as later code blocks will use variables from previous ones.</p>
<p>To get started, first import the <code>ee</code>, trigger the Earth Engine authentication flow, and import the <code>hydrafloods</code> package:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">ee</span>
<span class="n">ee</span><span class="o">.</span><span class="n">Initialize</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">hydrafloods</span> <span class="k">as</span> <span class="nn">hf</span>
</code></pre></div>

<h2 id="get-a-hfdataset">Get a <code>hf.Dataset</code></h2>
<p>You can access commonly used image collections on Earth Engine as a <a href="/hydra-floods/datasets/"><code>hydrafloods.Dataset</code></a> to quickly filter by space and time as well as apply pre-written QA masking functions.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># define a geographic region</span>
<span class="n">region</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">country_bbox</span><span class="p">(</span><span class="s2">&quot;Cambodia&quot;</span><span class="p">)</span>

<span class="c1"># define start and end times</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="s2">&quot;2019-09-15&quot;</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="s2">&quot;2019-09-20&quot;</span>

<span class="c1"># get the Sentinel 1 collection as a Dataset</span>
<span class="n">s1</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">Sentinel1</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span><span class="p">)</span>

<span class="c1"># print dataset info</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>

<span class="c1"># print the number of images in Dataset</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s1</span><span class="o">.</span><span class="n">n_images</span><span class="p">)</span>

<span class="c1"># print a list of image acquisition dates for the Dataset</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s1</span><span class="o">.</span><span class="n">dates</span><span class="p">)</span>

<span class="c1"># access the actual ee.ImageCollection object</span>
<span class="n">ee_collection</span> <span class="o">=</span> <span class="n">s1</span><span class="o">.</span><span class="n">collection</span>
</code></pre></div>

<p>The <code>hydrafloods.Dataset</code> object is a wrapper around an <code>ee.ImageCollection</code> by applying the spatial and temporal filtering upon initialization.
This provides a quick and consistent access to imagery. The <code>Dataset</code> class also provides utility functionality to make working with and managing multiple image collections less verbose.</p>
<p>There are many ways to interface with datasets (i.e. ImageCollections) using <code>hydrafloods</code>, more examples on merging or joining datasets can be found on the <a href="/hydra-floods/using-datasets/">Using Dataset class</a> page.</p>
<h2 id="image-processing">Image processing</h2>
<p>The main purpose of <code>hydrafloods</code> is to lower the barrier to creating high-quality surface water maps, this requires image processing. Although the Dataset class wraps an Earth Engine image collection we can apply image processing functions using <a href="/hydra-floods/datasets/#hydrafloods.datasets.Dataset.apply_func"><code>apply_func()</code></a> by passing a function object.</p>
<p>This method wraps a function that accepts an image as the first argument (which most <code>hydrafloods</code> image processing algorithms do) and maps it over the collection. For example, we would like to apply a speckle filter algorithm on SAR imagery. We can easily do this with the following code.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># apply a speckle filtering algorithm on SAR imagery</span>
<span class="c1"># here we will use the Gamma Map filter</span>
<span class="n">filtered</span> <span class="o">=</span> <span class="n">s1</span><span class="o">.</span><span class="n">apply_func</span><span class="p">(</span><span class="n">hf</span><span class="o">.</span><span class="n">gamma_map</span><span class="p">)</span>
</code></pre></div>

<p>The previous example is synonymous with using <code>s1.collection = s1.collection.map(hf.gamma_map)</code> which access the image collection, applies the function, and sets the results to the <code>s1.collection</code> property. Although this technically works, using the <code>apply_func()</code> method is advantageous and preferred as it allows us to pass arbitrary keyword parameters to functions which we want to apply. For example, the water mapping algorithms found in <a href="/hydra-floods/thresholding/"><code>hydrafloods.thresholding</code></a> take many keyword parameters and we can customize function as in the following example.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># apply the edge otsu surface water mapping</span>
<span class="c1"># we apply this on the speckle filtered SAR data</span>
<span class="n">water_maps</span> <span class="o">=</span> <span class="n">filtered</span><span class="o">.</span><span class="n">apply_func</span><span class="p">(</span><span class="n">hf</span><span class="o">.</span><span class="n">edge_otsu</span><span class="p">,</span>
    <span class="n">initial_threshold</span><span class="o">=-</span><span class="mi">16</span><span class="p">,</span>
    <span class="n">thresh_no_data</span><span class="o">=-</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">edge_buffer</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="n">scale</span><span class="o">=</span><span class="mi">250</span>
<span class="p">)</span>
</code></pre></div>

<p>It should be noted that using the <code>apply_func()</code> method will return a <code>hydrafloods.Dataset</code> where the collection property has the results of the function. One can access the <code>ee.ImageCollection</code> object and reduce to and image using the following code:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># reduce the Dataset.collection property to an ee.Image</span>
<span class="n">water_img</span> <span class="o">=</span> <span class="n">water_maps</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">)</span>
</code></pre></div>

<p>There are a variety of image processing functions available in <code>hydrafloods</code>, more information on specific algorithms can be found on the <a href="/hydra-floods/algorithms/">Algorithms</a> page.</p>
<h2 id="time-series-processing">Time series processing</h2>
<p>In addition to image processing, processing data in time is valuable. Therefore, <code>hydrafloods</code> has a specific module for time series processing, <a href="/hydra-floods/timeseries/"><code>hydrafloods.timeseries</code></a>, specifically for processing stacks of imagery in time.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># import in the timeseries module</span>
<span class="kn">from</span> <span class="nn">hydrafloods</span> <span class="kn">import</span> <span class="n">timeseries</span>
</code></pre></div>

<p>Here we are going to take a longer time series of SAR imagery for 2019 so we have more data for our model:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># define start and end times for one year in 2019</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="s2">&quot;2019-01-01&quot;</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="s2">&quot;2020-01-01&quot;</span>

<span class="c1"># get the Sentinel 1 collection as a Dataset</span>
<span class="c1"># using Cambodia still as the region</span>
<span class="n">s1</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">Sentinel1</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span><span class="p">)</span>
</code></pre></div>

<p>Now that we have our time series of data, we can begin to model some temporal information. For example, we want to model a harmonic trend of SAR imagery to predict an image using time information.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># fit a harmonic trend model on the VV band in time</span>
<span class="c1"># use two harmonic cycles</span>
<span class="n">harmonics_weights</span> <span class="o">=</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">fit_harmonic_trend</span><span class="p">(</span>
    <span class="n">s1</span><span class="p">,</span> <span class="n">dependent</span><span class="o">=</span><span class="s1">&#39;VV&#39;</span><span class="p">,</span> <span class="n">n_cycles</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span>
</code></pre></div>

<p>The result from <a href="/hydra-floods/timeseries/#hydrafloods.timeseries.fit_harmonic_trend"><code>fit_harmonic_trend()</code></a> will be an image with many bands. Some bands are the coefficeint weights for prediction (i.e. cos_1, sin_1, or time), others can be awareness information such as number of valid observations used (i.e. n). So we will filter out the coefficient weight bands we need which are cos_n, sin_n and time which start with either "c", "t", or "s". Then get a dummy image with time information and apply the prediction.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># extract bands needed for prediction</span>
<span class="n">harmonic_weights</span> <span class="o">=</span> <span class="n">harmonics_weights</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;^c|t|s).*&quot;</span><span class="p">)</span>

<span class="c1"># get a dummy image with just time information for prediction</span>
<span class="c1"># for flooding date in Oct 2019</span>
<span class="n">dummy_img</span> <span class="o">=</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">get_dummy_img</span><span class="p">(</span><span class="s2">&quot;2019-10-05&quot;</span><span class="p">)</span>

<span class="c1"># predict the VV values using the dummy img and computed harmonic coeffients</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">timeseries</span><span class="o">.</span><span class="n">add_harmonic_coefs</span><span class="p">(</span><span class="n">dummy_img</span><span class="p">)</span>
    <span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">harmonic_weights</span><span class="p">)</span>
    <span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="s2">&quot;sum&quot;</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>

<p>Time series functionality in <code>hydrafloods</code> is focused around modeling data in time, more information on the functions can be found in the <a href="/hydra-floods/timeseries/">timeseries module API reference</a></p>
<h2 id="machine-learning">Machine Learning</h2>
<p><code>hydrafloods</code> also has a specific module for machine learning workflows with Earth Engine, <a href="/hydra-floods/ml/"><code>hydrafloods.ml</code></a>.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># import in the ml module</span>
<span class="kn">from</span> <span class="nn">hydrafloods</span> <span class="kn">import</span> <span class="n">ml</span>
</code></pre></div>

<p>The aim with this module is to make high-quality machine learning workflows easier and less verbose when working with Earth Engine. However, we will will still need to access feature collection information to train models. Here we will define some parameters for an example:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># define some parameters for the ml workflow we will use</span>
<span class="c1"># define feature columns to use for training/prediction</span>
<span class="n">feature_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;VV&#39;</span><span class="p">,</span><span class="s1">&#39;VH&#39;</span><span class="p">,</span><span class="s1">&#39;ratio&#39;</span><span class="p">,</span><span class="s1">&#39;ndpi&#39;</span><span class="p">]</span>

<span class="c1"># get a feature collection for training/testing</span>
<span class="n">fc</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ee</span><span class="o">.</span><span class="n">FeatureCollection</span><span class="p">(</span><span class="s2">&quot;projects/servir-ee/assets/sar_wi_samples_20200825104400&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">randomColumn</span><span class="p">(</span><span class="s2">&quot;random&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># split the feature collection into training/testing datasets</span>
<span class="c1"># good practice to do this</span>
<span class="n">training</span> <span class="o">=</span> <span class="n">fc</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">lte</span><span class="p">(</span><span class="s2">&quot;random&quot;</span><span class="p">,</span><span class="mf">0.7</span><span class="p">))</span>
<span class="n">testing</span> <span class="o">=</span> <span class="n">fc</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">gt</span><span class="p">(</span><span class="s2">&quot;random&quot;</span><span class="p">,</span><span class="mf">0.7</span><span class="p">))</span>
</code></pre></div>

<p>Now that we have our datasets and features defined, we can begin the workflow. Typically with machine learning one would perform a feature scaling to get all features within the same range, this helps with numerical stability, training speed, and model accuracy. This can be quite cumbersome to do efficiently in Earth Engine...however, the <code>ml</code> module allows us to scale and train in one shot.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># scale training dataset and train random forest model</span>
<span class="c1"># note this returns a trained ee.Classifier and dictionary to scale data later</span>
<span class="n">rf</span><span class="p">,</span> <span class="n">scaling_dict</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">random_forest_ee</span><span class="p">(</span>
    <span class="mi">25</span><span class="p">,</span>
    <span class="n">training</span><span class="p">,</span>
    <span class="n">feature_names</span><span class="p">,</span>
    <span class="s1">&#39;mndwi&#39;</span><span class="p">,</span>
    <span class="n">scaling</span><span class="o">=</span><span class="s2">&quot;standard&quot;</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;regression&quot;</span>
<span class="p">)</span>
</code></pre></div>

<p>This function returns a train random forest <code>ee.Classifier</code> and a <code>ee.Dictionary</code> with per band values needed to scale other feature collections or imagery as seen in the next example. Here we scale the testing dataset using the values from the training dataset and apply the model on the feature collection.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># scale the testing dataset using the scaling values from training</span>
<span class="n">testing_norm</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">standard_feature_scaling</span><span class="p">(</span><span class="n">testing</span><span class="p">,</span><span class="n">scaling_dict</span><span class="p">,</span><span class="n">feature_names</span><span class="p">)</span>

<span class="c1"># apply random forest model on scaled test feature collection dataset</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">testing_norm</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span><span class="s2">&quot;predicted&quot;</span><span class="p">)</span>
</code></pre></div>

<p>Majority of the time we would like to apply the predictions on imagery and the <code>ml</code> module has functionality to perform the scaling for imagery easily. First we have to add the bands to dataset collection which the <code>Sentinel1</code> dataset class has a custom method to add the VV/VH ratio and VV-VH normalized difference bands.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># add bands for features used in RF model</span>
<span class="n">s1_features</span> <span class="o">=</span> <span class="n">s1</span><span class="o">.</span><span class="n">apply_func</span><span class="p">(</span><span class="n">hf</span><span class="o">.</span><span class="n">add_indices</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;vv_vh_ratio&quot;</span><span class="p">,</span> <span class="s2">&quot;ndpi&quot;</span><span class="p">])</span>

<span class="c1"># scale the bands using the scaling_dict</span>
<span class="n">s1_norm</span> <span class="o">=</span> <span class="n">s1_features</span><span class="o">.</span><span class="n">apply_func</span><span class="p">(</span>
    <span class="n">ml</span><span class="o">.</span><span class="n">standard_image_scaling</span><span class="p">,</span>
    <span class="n">scaling_dict</span><span class="o">=</span><span class="n">scaling_dict</span><span class="p">,</span>
    <span class="n">feature_names</span><span class="o">=</span><span class="n">feature_names</span>
<span class="p">)</span>

<span class="c1"># apply the prediction on the dataset</span>
<span class="n">predicted</span> <span class="o">=</span> <span class="n">s1_norm</span><span class="o">.</span><span class="n">apply_func</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">rf</span><span class="p">))</span>
</code></pre></div>

<p>Again, most of the functionality around the <code>hydrafloods.ml</code> module is to make end-to-end machine learning work flows more straightforward. Please see the <a href="/hydra-floods/ml/">ml module</a> documentation for information on functions.</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../installation/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Installation" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Installation
            </div>
          </div>
        </a>
      
      
        
        <a href="../using-datasets/" class="md-footer__link md-footer__link--next" aria-label="Next: Using the Dataset class" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Using the Dataset class
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.5e67fbfe.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c44cc438.min.js"></script>
      
    
  </body>
</html>